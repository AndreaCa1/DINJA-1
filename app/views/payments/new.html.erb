<div class="order-process-container">
  <div class="cart-confirm-container">

    <div class="order-confirm-heading text-center">
      <h2>ORDER DETAILS</h2>
      <hr>
    </div>
    <div class="row">
      <div class="confirm-all-info">

        <div class="col-xs-12 col-sm-6 confirm-order" >
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Your order</h3>
            </div>
            <div class="panel-body">
              <% @order.order_items.each do |item| %>
                <div class="order-item-checkout">
                  <p><%= item.recipe.name %></p>
                  <p><%= item.recipe.price %>.00€</p>
                  <p><%= item.quantity %></p>
                  <p><%= item.recipe.price*item.quantity %>.00€</p>
                </div>
              <% end %>
              <div class="line-button">
                <hr>
                <%= link_to edit_order_path(@order) do %>
                  <button class="btn btn-default pull-right confirm-order-button">Edit</button>
                <% end %>
                <h4>Grand total: <%= @grand_total %>.00€</h4>
              </div>
            </div>
          </div>
        </div>


        <div class="col-xs-12 col-sm-6 confirm-address">



          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Pay with card</h3>
            </div>
            <div class="panel-body">

            <%= form_tag order_payments_path(@order), id: "payment_form" do %>
              <article>
                <label class="price">
                  <span>Total due: <%= humanized_money_with_symbol(@order.price) %></span>
                </label>
              </article>
              <hr>

              <button class="payment-button btn pull-right">Pay now</button>

              <% content_for :after_js do %>
                <script src="https://checkout.stripe.com/checkout.js"></script>
                <script>
                  var handler = StripeCheckout.configure({
                    key: '<%= Rails.configuration.stripe[:publishable_key] %>',
                    image: '<%= asset_path "logo3.png" %>',
                    locale: 'auto',
                    name: 'Dinja',
                    description: '<%= @order.order_items.size %> recipes',
                    amount: <%= @order.price_cents %>,
                    currency: 'EUR',
                    email: '<%= @user.email %>',
                    token: function(token) {
                      $('.loading').removeClass('hidden');
                      var $input = $('<input type=hidden name=stripeToken />').val(token.id);
                      $('#payment_form').append($input).submit();
                    }
                  });

                  $('.payment-button').on('click', function(e) {
                    e.preventDefault();
                    handler.open();
                  });
                </script>
              <% end %>


            <% end %>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Address for delivery: </h3>
              <div id="address_map">
                <%= render "payments/address_map", order: @order %>
              </div>
            </div>
            <div class="panel-body">

              <div id="current-address" class="edit-address">
                <%= render "orders/address", order: @order %>
              </div>

              <div id="edit-address-form" class="edit-address hidden">
                <%= simple_form_for @order, url: update_address_order_path(@order), method: :patch, remote: true do |f| %>
                  <%= f.input :address, placeholder: 'Address' %>
                  <%= f.button :submit, 'Save changes', id: 'save-delivery-address', class: 'button btn btn-primary pull-right'  %>
                <% end %>
              </div>
            </div>
          </div>
  </div>
</div>
